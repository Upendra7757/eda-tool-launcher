{% extends "launcher/base.html" %}
{% block content %}

<style>
/* =====================================================
   CATEGORY – GLASSMORPHISM UNIFIED WITH BASE
===================================================== */

/* Remove any page-level background – base.html owns it */

/* Tool Card */
.app-card {
  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.16),
    rgba(255,255,255,0.06)
  );
  border: 1px solid rgba(255,255,255,0.22);
  border-radius: 22px;
  padding: 28px;
  backdrop-filter: blur(22px) saturate(140%);
  -webkit-backdrop-filter: blur(22px) saturate(140%);
  box-shadow:
    0 30px 90px rgba(0,0,0,0.55),
    inset 0 1px 0 rgba(255,255,255,0.16);
  transition: transform .35s ease, box-shadow .35s ease;
  animation: toolEnter .45s ease both;
}

/* Entry animation */
@keyframes toolEnter {
  from {
    opacity: 0;
    transform: translateY(18px) scale(.97);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Hover effect */
.app-card:hover {
  transform: translateY(-6px);
  box-shadow:
    0 42px 120px rgba(0,0,0,0.65),
    0 0 0 1px rgba(124,58,237,0.28);
}

/* Tool icon glass */
.tool-card .w-14 {
  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.25),
    rgba(255,255,255,0.10)
  );
  border: 1px solid rgba(255,255,255,0.35);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.25),
    0 14px 40px rgba(0,0,0,0.55);
}

/* Title refinement */
.tool-card h2 {
  letter-spacing: -0.015em;
}

/* Expand panel divider */
.tool-card .border-t {
  border-color: rgba(255,255,255,0.28);
}

/* Launch panel spacing */
#panel-* {
  animation: panelOpen .35s ease both;
}

@keyframes panelOpen {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Secondary button – softened to match base */
.btn-secondary {
  background: linear-gradient(135deg,#047857,#059669,#10b981);
  border-radius: 14px;
  font-weight: 600;
  transition: all .3s ease;
}

.btn-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 18px 55px rgba(16,185,129,0.55);
}

/* Back button polish */
.tool-card button.bg-white\/20 {
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,0.25);
  transition: all .25s ease;
}

.tool-card button.bg-white\/20:hover {
  background: rgba(255,255,255,0.32);
  transform: translateX(-6px);
}
</style>


<!-- HEADER -->
<div class="mb-10">
  <h1 class="text-4xl font-extrabold text-white">{{ category.name }}</h1>
  <p class="text-gray-200">Select a tool to launch</p>
</div>

<!-- TOOL LIST -->
<div class="space-y-8">

{% for tool in tools %}
<div id="card-{{ tool.slug }}" class="tool-card app-card transition hover:shadow-xl">

  <!-- HEADER -->
  <div class="flex justify-between items-start">

    <!-- ICON + TEXT -->
    <div class="flex items-center gap-4">

      <!-- TOOL ICON -->
      <div class="w-14 h-14 rounded-2xl flex items-center justify-center
                  bg-white/20 border border-white/30 backdrop-blur">

        {% if tool.slug == "verilator" %}
        <!-- Verilator / Simulation -->
        <svg class="w-8 h-8 text-blue-300" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24">
          <path d="M3 6h12M3 12h18M3 18h12"/>
        </svg>

        {% elif tool.slug == "klayout" %}
        <!-- KLayout -->
        <svg class="w-8 h-8 text-purple-300" fill="none" stroke="currentColor" stroke-width="1.8"
             viewBox="0 0 24 24">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M3 9h18M9 3v18"/>
        </svg>

        {% elif tool.slug == "magic" %}
        <!-- Magic -->
        <svg class="w-8 h-8 text-pink-300" fill="none" stroke="currentColor" stroke-width="1.8"
             viewBox="0 0 24 24">
          <path d="M12 2l3 7 7 1-5 5 1 7-6-3-6 3 1-7-5-5 7-1z"/>
        </svg>

        {% elif tool.slug == "custom-layout-editor" %}
        <!-- Custom Layout Editor -->
        <svg class="w-8 h-8 text-teal-300" fill="none" stroke="currentColor" stroke-width="1.8"
             viewBox="0 0 24 24">
          <rect x="4" y="4" width="16" height="16"/>
          <path d="M4 9h16M9 4v16"/>
        </svg>

        {% else %}
        <!-- Default -->
        <svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" stroke-width="1.6"
             viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="9"/>
        </svg>
        {% endif %}

      </div>

      <!-- TOOL NAME -->
      <div>
        <h2 class="text-2xl font-semibold text-white">{{ tool.name }}</h2>
        <p class="text-gray-200 text-sm">{{ tool.description }}</p>
      </div>

    </div>

    <!-- LAUNCH -->
    <button class="btn-primary"
            onclick="toggleLaunchPanel('{{ tool.slug }}')">
      Launch
    </button>

  </div>

  <!-- EXPAND PANEL -->
  <div id="panel-{{ tool.slug }}" class="hidden mt-6 border-t border-white/30 pt-6">

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-6">

      <button class="btn-primary py-3 text-lg"
              onclick="launchDesktop('{{ tool.slug }}')">
        Launch Desktop
      </button>

      <button class="btn-secondary py-3 text-lg"
              onclick="launchWeb('{{ tool.slug }}')">
        Launch Web
      </button>

    </div>

    <div id="status-{{ tool.slug }}" class="text-gray-200 mb-4"></div>

    <button onclick="resetToolList()"
            class="mt-2 px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30">
      ← Back to Tools
    </button>

  </div>
</div>
{% endfor %}

</div>

<script>
function toggleLaunchPanel(slug) {
  const cards = document.querySelectorAll(".tool-card");
  const panel = document.getElementById("panel-" + slug);
  const card  = document.getElementById("card-" + slug);

  if (!panel.classList.contains("hidden")) {
    resetToolList();
    return;
  }

  cards.forEach(c => c.classList.add("hidden"));
  card.classList.remove("hidden");
  panel.classList.remove("hidden");
}

function resetToolList() {
  document.querySelectorAll(".tool-card").forEach(card => card.classList.remove("hidden"));
  document.querySelectorAll("[id^='panel-']").forEach(p => p.classList.add("hidden"));
}

function launchDesktop(slug) {
  const status = document.getElementById("status-" + slug);
  status.innerText = "Launching desktop tool...";
  fetch(`/launch-desktop/${slug}/`, {
    method: "POST",
    headers: { "X-CSRFToken": "{{ csrf_token }}" }
  })
  .then(r => r.json())
  .then(d => status.innerText = d.ok ? d.message : d.error);
}

function launchWeb(slug) {
  const status = document.getElementById("status-" + slug);
  status.innerText = "Opening web workspace...";
  fetch(`/launch-web/${slug}/`, {
    method: "POST",
    headers: { "X-CSRFToken": "{{ csrf_token }}" }
  })
  .then(r => r.json())
  .then(d => {
    if (d.ok && d.url) window.location.href = d.url;
    else status.innerText = d.error;
  });
}
</script>

{% endblock %}
